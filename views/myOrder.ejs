<!DOCTYPE html>
<html>

	<head>
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>小能手帮帮</title>
		<link rel="stylesheet" href="/css/xns-bb.css" />
		<link rel="stylesheet" type="text/css" href="/aui/css/aui.2.0.css" />
		<link rel="stylesheet" type="text/css" href="/css/animate.css" />
		<script src="//cdn.bootcss.com/jquery/3.1.0/jquery.min.js"></script>
		<script type="text/javascript" src="/aui/script/aui-toast.js"></script>
		<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
	</head>

	<body>
		<section class="aui-content-padded">
			<div class="aui-card-list">
				<div class="aui-card-list-header">
					<b>我的订单</b>
				</div>
			</div>
		</section>
		<section class="aui-content-padded">
			<% if(orders.length == 0) {%>
			<div class="aui-card-list">

				<div class="aui-card-list-header">
					<a href="/">没有订单,点击这里去下单吧</a>
				</div>
			</div>
			<%}%>

			<% for(var i in orders) {%>
			<div class="aui-card-list">
				<div class="aui-card-list-header">
					订单号：
					<%=orders[i].orderNo%>
					<div class="aui-label aui-label-info">
						<%=orders[i].tp%>
					</div>
				</div>
				<div class="aui-card-list-content-padded">
					订单描述：
					<%= orders[i].des%><br> 联系人：
					<%= orders[i].userName%><br> 地址：
					<%= orders[i].userAddr%><br> 电话：
					<%= orders[i].userPhone%><br> 预约时间：
					<%= orders[i].orderTm%><br> 订单金额：
					<%= orders[i].price%>元<br> 下单时间：
					<%= orders[i].tm%>
				</div>
				<%if(orders[i].pay==0){%>
				<div class="aui-card-list-footer">

					<span>订单状态：未支付</span>
				</div>
				<div class="aui-content-padded" style="padding-bottom: 10px;">
					<div class="aui-btn aui-btn-info aui-btn-block aui-btn-sm" onclick="doPay('<%= orders[i].payUrl%>')">现在支付</div>
				</div>
				<%} else {%>
				<div class="aui-card-list-footer">

					<span>订单状态：已支付</span>
				</div>
				<%}%>
			</div>
			<%}%>
		</section>
	</body>
	<script>
		toast = new auiToast({})

		function doPay(payUrl) {
			toast.loading({
				title: "加载中",
				duration: 5000
			});

			$.get(payUrl, function(res) {
				toast.hide();
				if(!res.err) {

					var payargs = res;
					//						payargs = payargs.replace(/&#34;/g, '"')
					WeixinJSBridge.invoke(
						"getBrandWCPayRequest", payargs,
						function(res) {
							if(res.err_msg == "get_brand_wcpay_request:ok") {
								// success
								toast.loading({
									title: "支付成功",
									duration: 5000
								});
								setTimeout(function() {

									location.reload();
								}, 3000);

							}
						});
				} else {
					alert(res.err);
				}

			});
		}
	</script>

</html>